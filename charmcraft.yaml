# Copyright 2024 Canonical, Ltd.
# See LICENSE file for licensing details.

type: charm
name: kubernetes-worker
summary: The workload bearing units of a Kubernetes cluster.
description: |
  Kubernetes is an open-source platform for deploying, scaling, and operations
  of application containers across a cluster of hosts. Kubernetes is portable
  in that it works with public, private, and hybrid clouds. Extensible through
  a pluggable infrastructure. Self healing in that it will automatically
  restart and place containers on healthy nodes if a node ever goes away.
links:
  contact:
    - Kevin Monroe <kevin.monroe@canonical.com>
    - Mateo Florido <mateo.florido@canonical.com>
    - Adam Dyess <adam.dyess@canonical.com>
  documentation: https://discourse.charmhub.io/t/kubernetes-worker-docs-index/6104
  source: https://github.com/charmed-kubernetes/charm-kubernetes-worker
  issues:
    - https://bugs.launchpad.net/charm-kubernetes-worker

assumes:
  - juju >= 3.1

peers:
  coordinator:
    # LP:2049953 needed for upgrading from < 1.29
    interface: coordinator
provides:
  cni:
    interface: kubernetes-cni
    scope: container
  container-runtime:
    interface: container-runtime
    scope: container
  cos-agent:
    interface: cos_agent
  ingress-proxy:
    interface: http
requires:
  aws:
    interface: aws-integration
  gcp:
    interface: gcp-integration
  azure:
    interface: azure-integration
  certificates:
    interface: tls-certificates
  kube-control:
    interface: kube-control
  tokens:
    interface: tokens

resources:
  cni-plugins:
    type: file
    filename: cni-plugins.tar.gz
    description: CNI network plugins for Kubernetes

bases:
  - build-on:
    - name: ubuntu
      channel: "20.04"
      architectures: ["amd64"]
    run-on:
    - name: ubuntu
      channel: "20.04"
      architectures: ["amd64"]
    - name: ubuntu
      channel: "22.04"
      architectures: ["amd64"]
    - name: ubuntu
      channel: "24.04"
      architectures: ["amd64"]
  - build-on:
    - name: ubuntu
      channel: "20.04"
      architectures: ["arm64"]
    run-on:
    - name: ubuntu
      channel: "20.04"
      architectures: ["arm64"]
    - name: ubuntu
      channel: "22.04"
      architectures: ["arm64"]
    - name: ubuntu
      channel: "24.04"
      architectures: ["arm64"]
  - build-on:
    - name: ubuntu
      channel: "20.04"
      architectures: ["s390x"]
    run-on:
    - name: ubuntu
      channel: "20.04"
      architectures: ["s390x"]
    - name: ubuntu
      channel: "22.04"
      architectures: ["s390x"]
    - name: ubuntu
      channel: "24.04"
      architectures: ["s390x"]
parts:
  charm:
    build-packages: [git]
